<!DOCTYPE html>
<html>
<head>
    <title>–†—É–ª–µ—Ç–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
        }

        .container {
            display: flex; /* Use flexbox for side-by-side layout */
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .roulette-container {
            flex: 1; /* Take up available space */
            margin-right: 20px; /* Space between roulette and sidebar */
        }

        #roulette {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 5px solid #333;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            transition: transform 5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        #roulette:after {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            margin-left: -10px;
            border-width: 15px 10px 0 10px;
            border-style: solid;
            border-color: #ff0000 transparent transparent transparent;
        }

        .segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            text-align: center;
            line-height: 100px; /* Vertically center text */
            font-size: 16px;
            color: #fff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-sizing: border-box; /* Include padding and border in element's total width and height */
        }

        .sidebar {
            flex: 0.3; /* Take up 30% of the space */
            padding: 10px;
            border-left: 1px solid #ccc;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #result {
            margin-top: 20px;
            font-weight: bold;
        }
        #timer {
            margin-top: 10px;
            color: #888;
        }

        /* Emoji styles */
        .emoji {
            font-size: 20px; /* Adjust the size as needed */
            vertical-align: middle; /* Align with text if any */
        }
    </style>
</head>
<body>

<div class="container">
    <div class="roulette-container">
        <h1>–ö—Ä—É—Ç–∏—Ç–µ —Ä—É–ª–µ—Ç–∫—É –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ!</h1>
        <div id="roulette">
            <!-- –°–µ–≥–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JavaScript'–æ–º -->
        </div>
        <button id="spinButton">–ö—Ä—É—Ç–∏—Ç—å (–†–∞–∑ –≤ 24 —á–∞—Å–∞)</button>
        <div id="result"></div>
        <div id="timer"></div>
    </div>

    <div class="sidebar">
        <h2>–í–∞—à –±–∞–ª–∞–Ω—Å</h2>
        <div id="balance">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <p>–ö—Ä—É—Ç–∏—Ç–µ —Ä—É–ª–µ—Ç–∫—É —Ä–∞–∑ –≤ 24 —á–∞—Å–∞, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞—Ç—å –ø—Ä–∏–∑—ã!</p>
    </div>
</div>

<script>
    const spinButton = document.getElementById('spinButton');
    const roulette = document.getElementById('roulette');
    const resultDiv = document.getElementById('result');
    const timerDiv = document.getElementById('timer');
    const balanceDiv = document.getElementById('balance');

    let canSpin = true;
    let timeLeft = 0;
    let timerInterval;

    const prizes = [
        {label: '10 ‚≠ê', color: '#E91E63'},
        {label: '5 ‚≠ê', color: '#9C27B0'},
        {label: 'üí©', color: '#795548'}, //Poop
        {label: '1.5 ‚≠ê', color: '#3F51B5'},
        {label: 'üí©', color: '#795548'}, //Poop
        {label: '3 ‚≠ê', color: '#03A9F4'},
        {label: 'üí©', color: '#795548'}, //Poop
        {label: '0.8 ‚≠ê', color: '#009688'},
        {label: '7 ‚≠ê', color: '#607D8B'},
        {label: '2 ‚≠ê', color: '#FF5722'}
    ];

    // Function to create segments dynamically
    function createSegments() {
        const rouletteElement = document.getElementById('roulette');
        const segmentCount = prizes.length;
        let angle = 0;
        const angleIncrement = 360 / segmentCount;

        prizes.forEach((prize, index) => {
            const segment = document.createElement('div');
            segment.classList.add('segment');
            segment.style.backgroundColor = prize.color;
            segment.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;

            // Add emoji for poop
            if (prize.label === 'üí©') {segment.innerHTML = '<span class="emoji">üí©</span>';
            } else {
                segment.textContent = prize.label;
            }

            // Adjust text color based on background brightness
            const bgColor = prize.color;
            const brightness = calculateBrightness(bgColor);
            segment.style.color = brightness > 128 ? '#000' : '#fff';

            rouletteElement.appendChild(segment);
            angle += angleIncrement;
        });
    }

    // Function to calculate brightness of a color
    function calculateBrightness(color) {
        color = color.replace('#', '');
        const r = parseInt(color.substring(0, 2), 16);
        const g = parseInt(color.substring(2, 4), 16);
        const b = parseInt(color.substring(4, 6), 16);
        const brightness = (0.299 * r + 0.587 * g + 0.114 * b);
        return brightness;
    }

    // Call the function to create segments when the page loads
    createSegments();

    // Function to get the last spin time from local storage
    function getLastSpinTime() {
        return localStorage.getItem('lastSpinTime');
    }

    // Function to save the current spin time to local storage
    function setLastSpinTime() {
        localStorage.setItem('lastSpinTime', Date.now());
    }

    // Function to calculate the time left until the next spin
    function calculateTimeLeft() {
        const lastSpinTime = getLastSpinTime();
        if (lastSpinTime) {
            const nextSpinTime = parseInt(lastSpinTime) + 24 * 60 * 60 * 1000; // 24 hours
            const now = Date.now();
            timeLeft = nextSpinTime - now;

            if (timeLeft > 0) {
                canSpin = false;
                spinButton.disabled = true;
            } else {
                canSpin = true;
                spinButton.disabled = false;
                timeLeft = 0;
            }
        } else {
            canSpin = true;
            spinButton.disabled = false;
            timeLeft = 0;
        }
    }

    // Function to update the timer
    function updateTimer() {
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        timerDiv.textContent = `–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è: ${hours}—á ${minutes}–º ${seconds}—Å`;
    }

    // Function to start the timer
    function startTimer() {
        calculateTimeLeft();
        updateTimer();
        timerInterval = setInterval(() => {
            timeLeft -= 1000;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                canSpin = true;
                spinButton.disabled = false;
                timerDiv.textContent = '';
            } else {
                updateTimer();
            }
        }, 1000);
    }

    // Function to request the balance from the Telegram bot
    function requestBalance() {
        if (window.Telegram && window.Telegram.WebApp) {
            const web_app = window.Telegram.WebApp;
            web_app.sendData(JSON.stringify({ action: 'getBalance' })); // Request balance from bot
        } else {
            console.log("Telegram WebApp not available. Cannot request balance.");
            balanceDiv.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–ª–∞–Ω—Å.';
        }
    }

    // Function to set the balance
    function setBalance(balance) {
        balanceDiv.textContent = `${balance} ‚≠ê`;
    }

    // Call requestBalance when the page loads
    requestBalance();

    // Initial check on page load
    startTimer();

    spinButton.addEventListener('click', () => {
        if (canSpin) {
            canSpin = false;
            spinButton.disabled = true;
            setLastSpinTime();

            const randomDegree = Math.floor(Math.random() * 3600) + 3600;
            roulette.style.transform = `rotate(${randomDegree}deg)`;

            setTimeout(() => {
                const winningIndex = Math.floor((randomDegree % 360) / (360 / prizes.length));
                const winningPrize = prizes[prizes.length - 1 - winningIndex]; // Correct for reverse order
                let resultText = '';
                if (winningPrize.label === 'üí©') {
                    resultText = '–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! <span class="emoji">üí©</span>';
                } else {
                    resultText = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${winningPrize.label}!`;
                }
                resultDiv.innerHTML = resultText; // Use innerHTML for emoji

                // Send winning prize data to the bot
                if (window.Telegram && window.Telegram.WebApp) {
                    const web_app = window.Telegram.WebApp;
                    web_app.sendData(JSON.stringify({ prize: winningPrize.label }));
                } else {
                    console.log("Telegram WebApp not available");
                    resultDiv.innerHTML += " (Data not sent to bot)";
                }

                startTimer();
            }, 5000); // Time matches the transition duration
        }
    });
</script>

</body>
</html>
